<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      data-bs-theme="white">
<th:block layout:fragment="css">
    <style>
        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .nav-scroller .nav {
            display: flex;
            flex-wrap: nowrap;
            padding-bottom: 1rem;
            margin-top: -1px;
            overflow-x: auto;
            text-align: center;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .bd-mode-toggle .dropdown-menu .active .bi {
            display: block !important;
        }

        .list-group {
            width: 100%;
            max-width: 460px;
            margin-inline: 1.5rem;
        }

        .form-check-input:checked + .form-checked-content {
            opacity: .5;
        }

        .form-check-input-placeholder {
            border-style: dashed;
        }

        [contenteditable]:focus {
            outline: 0;
        }

        .list-group-checkable .list-group-item {
            cursor: pointer;
        }

        .list-group-item-check {
            position: absolute;
            clip: rect(0, 0, 0, 0);
        }

        .list-group-item-check:hover + .list-group-item {
            background-color: var(--bs-secondary-bg);
        }

        .list-group-item-check:checked + .list-group-item {
            color: #fff;
            background-color: var(--bs-primary);
            border-color: var(--bs-primary);
        }

        .list-group-item-check[disabled] + .list-group-item,
        .list-group-item-check:disabled + .list-group-item {
            pointer-events: none;
            filter: none;
            opacity: .5;
        }

        .list-group-radio .list-group-item {
            cursor: pointer;
            border-radius: .5rem;
        }

        .list-group-radio .form-check-input {
            z-index: 2;
            margin-top: -.5em;
        }

        .list-group-radio .list-group-item:hover,
        .list-group-radio .list-group-item:focus {
            background-color: var(--bs-secondary-bg);
        }

        .list-group-radio .form-check-input:checked + .list-group-item {
            background-color: var(--bs-body);
            border-color: var(--bs-primary);
            box-shadow: 0 0 0 2px var(--bs-primary);
        }

        .list-group-radio .form-check-input[disabled] + .list-group-item,
        .list-group-radio .form-check-input:disabled + .list-group-item {
            pointer-events: none;
            filter: none;
            opacity: .5;
        }

        .list-group-item {
            margin-top: 50px;
        }

        @keyframes scale-in-ver-top {
            0% {
                transform: scaleY(0);
                transform-origin: top;
                opacity: 0;
            }
            100% {
                transform: scaleY(1);
                transform-origin: top;
                opacity: 1;
            }
        }

        .scale-in-ver-top {
            animation: scale-in-ver-top 0.125s ease-out both;
        }
    </style>
</th:block>
<th:block layout:fragment="javascript">
    <script src="/js/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="/js/tables/datatables-demo.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let certificationCode;
        let newPhoneNumber
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('input[name="listGroupCheckableRadios"]').forEach(function (radio) {
                radio.addEventListener('change', function () {
                    if (this.id === 'listGroupCheckableRadios1') {
                        var phoneModal = new bootstrap.Modal(document.getElementById('phoneModal'));
                        phoneModal.show();
                    } else if (this.id === 'listGroupCheckableRadios2') {
                        var addressModal = new bootstrap.Modal(document.getElementById('addressModal'));
                        addressModal.show();
                    }
                });
            });

            document.getElementById('verifyPhoneButton').addEventListener('click', function () {
                newPhoneNumber = document.getElementById('newPhoneNumber').value;
                let certificationNumber =  Math.floor(Math.random() * 9000 + 1000).toString();
                console.log(certificationNumber);
                $.ajax({
                    url: "/employee/send-one",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        phoneNumber: newPhoneNumber,
                        certificationNumber:certificationNumber
                    }),
                    success: function() {
                        certificationCode = certificationNumber;  // 서버에서 받은 코드를 변수에 저장
                        alert("인증 코드가 전송되었습니다.");

                    },
                    error: function() {
                        alert("인증 코드 전송에 실패했습니다.");
                    }
                });
            });

            document.getElementById('verificationCodeButton').addEventListener('click', function () {
                let inputCode = document.getElementById('verificationCode').value;
                console.log("certificationCode = " + certificationCode);
                console.log("certificationCode의 타입 " + typeof certificationCode);
                console.log("inputCode = " + inputCode);
                console.log("inputCode의 타입 " + typeof inputCode);
                if (inputCode === certificationCode.toString()) {
                    alert("인증 성공");
                    $.ajax({
                        url: "/employee/modifyphonenumber",
                        type: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify({
                            newPhoneNumber: newPhoneNumber
                        }),
                        success: function() {
                            window.location.href = "/main";
                        },
                        error: function() {
                            alert("핸드폰 번호 변경에 실패했습니다.");
                        }
                    });
                } else {
                    alert("인증 실패");
                }
            });
        });
    </script>
</th:block>

<th:block layout:fragment="content">
    <h1>내정보변경</h1>
    <hr>

    <div class="d-flex flex-column flex-md-row p-4 gap-4 py-md-5 align-items-center justify-content-center">
        <div class="list-group list-group-checkable d-grid gap-2 border-0">
            <input class="list-group-item-check pe-none" type="radio" name="listGroupCheckableRadios" id="listGroupCheckableRadios1" value="">
            <label class="list-group-item rounded-3 py-3" for="listGroupCheckableRadios1">
                핸드폰 번호 바꾸기
            </label>

            <input class="list-group-item-check pe-none" type="radio" name="listGroupCheckableRadios" id="listGroupCheckableRadios2" value="">
            <label class="list-group-item rounded-3 py-3" for="listGroupCheckableRadios2">
                집 주소 바꾸기
            </label>
        </div>
    </div>

    <!-- 핸드폰 번호 바꾸기 모달 -->
    <div class="modal fade" id="phoneModal" tabindex="-1" aria-labelledby="phoneModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content scale-in-ver-top">
                <div class="modal-header">
                    <h5 class="modal-title" id="phoneModalLabel">핸드폰 번호 바꾸기</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="currentPhoneNumber" class="form-label">기존 핸드폰 번호</label>
                        <input type="text" class="form-control" id="currentPhoneNumber" th:value="${employee.getPhoneNumber()}">
                    </div>
                    <div class="mb-3">
                        <label for="newPhoneNumber" class="form-label">새 핸드폰 번호</label>
                        <input type="text" class="form-control" id="newPhoneNumber" placeholder="010-9876-5432">
                        <button id="verifyPhoneButton" class="btn btn-primary">핸드폰 인증</button>
                    </div>
                    <div id="verificationContainer" class="verification-container d-flex gap-2">
                        <input type="text" class="form-control" id="verificationCode" placeholder="인증번호를 입력하세요">
                        <button class="btn btn-primary" id="verificationCodeButton">확인</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary">저장</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 집 주소 바꾸기 모달 -->
    <div class="modal fade" id="addressModal" tabindex="-1" aria-labelledby="addressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content scale-in-ver-top">
                <div class="modal-header">
                    <h5 class="modal-title" id="addressModalLabel">집 주소 바꾸기</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="currentAddress" class="form-label">기존 집 주소</label>
                        <input type="text" class="form-control" id="currentAddress" placeholder="서울특별시 ...">
                    </div>
                    <div class="mb-3">
                        <label for="newAddress" class="form-label">새 집 주소</label>
                        <input type="text" class="form-control" id="newAddress" placeholder="부산광역시 ...">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary">저장</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
</html>
